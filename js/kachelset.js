// koffee 1.4.0

/*
000   000   0000000    0000000  000   000  00000000  000       0000000  00000000  000000000
000  000   000   000  000       000   000  000       000      000       000          000   
0000000    000000000  000       000000000  0000000   000      0000000   0000000      000   
000  000   000   000  000       000   000  000       000           000  000          000   
000   000  000   000   0000000  000   000  00000000  0000000  0000000   00000000     000
 */
var KachelSet, electron, klog, post, prefs, ref,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    indexOf = [].indexOf;

ref = require('kxk'), post = ref.post, prefs = ref.prefs, klog = ref.klog;

electron = require('electron');

KachelSet = (function() {
    function KachelSet(mainId) {
        this.onKachelLoad = bind(this.onKachelLoad, this);
        this.onToggleSet = bind(this.onToggleSet, this);
        this.onNewSet = bind(this.onNewSet, this);
        this.onKachelFocus = bind(this.onKachelFocus, this);
        var obj;
        this.focusKachel = null;
        this.dict = (
            obj = {},
            obj["" + mainId] = 'main',
            obj
        );
        this.wids = {
            main: mainId
        };
        this.set = [];
        this.sid = '';
        post.on('kachelLoad', this.onKachelLoad);
        post.on('toggleSet', this.onToggleSet);
        post.on('newSet', this.onNewSet);
        post.on('kachelFocus', this.onKachelFocus);
    }

    KachelSet.prototype.onKachelFocus = function(winId) {
        if (this.dict[winId] !== 'main') {
            return this.focusKachel = electron.BrowserWindow.fromId(winId);
        }
    };

    KachelSet.prototype.onNewSet = function() {
        var sets;
        sets = prefs.get('sets', ['']);
        sets.push("" + sets.length);
        prefs.set('sets', sets);
        return this.load(sets.slice(-1)[0]);
    };

    KachelSet.prototype.onToggleSet = function() {
        var index, sets;
        sets = prefs.get('sets', ['']);
        index = Math.max(0, sets.indexOf(this.sid));
        if (index >= sets.length - 1) {
            index = -1;
        }
        return this.load(sets[index + 1]);
    };

    KachelSet.prototype.load = function(newSid) {
        var i, j, k, kachelId, l, len, len1, len2, len3, newSet, oldKacheln, ref1, ref2, showIds, updateIds;
        if (newSid != null) {
            newSid;
        } else {
            newSid = prefs.get('set', '');
        }
        oldKacheln = prefs.get("kacheln" + this.sid, []);
        this.kachelIds = [];
        updateIds = ['main'];
        showIds = [];
        newSet = prefs.get("kacheln" + newSid, []);
        ref1 = newSet != null ? newSet : [];
        for (i = 0, len = ref1.length; i < len; i++) {
            kachelId = ref1[i];
            if (kachelId !== 'main') {
                if (this.set.indexOf(kachelId) >= 0) {
                    updateIds.push(kachelId);
                    this.set.splice(this.set.indexOf(kachelId), 1);
                } else {
                    showIds.push(kachelId);
                    if (!this.wids[kachelId]) {
                        this.kachelIds.push(kachelId);
                    }
                }
            }
        }
        if (this.set.length) {
            ref2 = this.set.slice();
            for (j = 0, len1 = ref2.length; j < len1; j++) {
                kachelId = ref2[j];
                if (kachelId !== 'main' && kachelId !== 'null' && kachelId !== null) {
                    if (this.wids[kachelId]) {
                        this.win(kachelId).hide();
                    } else {
                        klog('no wid for', kachelId);
                    }
                }
            }
        }
        prefs.set("kacheln" + this.sid, oldKacheln);
        this.sid = newSid;
        prefs.set('set', this.sid);
        this.set = newSet;
        for (k = 0, len2 = updateIds.length; k < len2; k++) {
            kachelId = updateIds[k];
            post.emit('updateBounds', kachelId);
        }
        for (l = 0, len3 = showIds.length; l < len3; l++) {
            kachelId = showIds[l];
            post.emit('newKachel', kachelId);
        }
        if (this.kachelIds.length === 0) {
            klog('loaded ++ focus main');
            this.win('main').focus();
            return post.emit('setLoaded');
        }
    };

    KachelSet.prototype.onKachelLoad = function(wid, kachelId) {
        var index;
        if (indexOf.call(this.set, kachelId) < 0) {
            this.set.push(kachelId);
            prefs.set("kacheln" + this.sid, this.set);
        }
        this.dict[wid] = kachelId;
        this.wids[kachelId] = wid;
        if (this.kachelIds) {
            index = this.kachelIds.indexOf(kachelId);
            if (index >= 0) {
                this.kachelIds.splice(index, 1);
                if (this.kachelIds.length === 0) {
                    klog('set loaded -- focus main');
                    this.win('main').focus();
                    return post.emit('setLoaded');
                }
            } else {
                return klog('unknown kachel?', kachelId);
            }
        }
    };

    KachelSet.prototype.remove = function(kachel) {
        var kachelId;
        if (this.focusKachel === kachel) {
            this.focusKachel = null;
        }
        if (kachelId = this.dict[kachel.id]) {
            if (this.set.indexOf(kachelId) >= 0) {
                this.set.splice(this.set.indexOf(kachelId), 1);
            }
            delete this.wids[kachelId];
            delete this.dict[kachel.id];
            return prefs.set("kacheln" + this.sid, this.set);
        }
    };

    KachelSet.prototype.win = function(kachelId) {
        return electron.BrowserWindow.fromId(this.wids[kachelId]);
    };

    return KachelSet;

})();

module.exports = KachelSet;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2FjaGVsc2V0LmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSwyQ0FBQTtJQUFBOzs7QUFRQSxNQUF3QixPQUFBLENBQVEsS0FBUixDQUF4QixFQUFFLGVBQUYsRUFBUSxpQkFBUixFQUFlOztBQUVmLFFBQUEsR0FBVyxPQUFBLENBQVEsVUFBUjs7QUFFTDtJQUVDLG1CQUFDLE1BQUQ7Ozs7O0FBRUMsWUFBQTtRQUFBLElBQUMsQ0FBQSxXQUFELEdBQWU7UUFDZixJQUFDLENBQUEsSUFBRCxHQUFTO2tCQUFBLEVBQUE7Z0JBQUEsRUFBQSxHQUFHLFVBQVUsTUFBYjs7O1FBQ1QsSUFBQyxDQUFBLElBQUQsR0FBUztZQUFBLElBQUEsRUFBSyxNQUFMOztRQUNULElBQUMsQ0FBQSxHQUFELEdBQVM7UUFDVCxJQUFDLENBQUEsR0FBRCxHQUFTO1FBRVQsSUFBSSxDQUFDLEVBQUwsQ0FBUSxZQUFSLEVBQXNCLElBQUMsQ0FBQSxZQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsV0FBUixFQUFzQixJQUFDLENBQUEsV0FBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFFBQVIsRUFBc0IsSUFBQyxDQUFBLFFBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxhQUFSLEVBQXNCLElBQUMsQ0FBQSxhQUF2QjtJQVhEOzt3QkFtQkgsYUFBQSxHQUFlLFNBQUMsS0FBRDtRQUdYLElBQUcsSUFBQyxDQUFBLElBQUssQ0FBQSxLQUFBLENBQU4sS0FBZ0IsTUFBbkI7bUJBQ0ksSUFBQyxDQUFBLFdBQUQsR0FBZSxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQXZCLENBQThCLEtBQTlCLEVBRG5COztJQUhXOzt3QkFZZixRQUFBLEdBQVUsU0FBQTtBQUVOLFlBQUE7UUFBQSxJQUFBLEdBQU8sS0FBSyxDQUFDLEdBQU4sQ0FBVSxNQUFWLEVBQWlCLENBQUMsRUFBRCxDQUFqQjtR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QSxJQUFLLENBQUEsTUFBTSxDQUFDLEVBQVAsQ0FBcEI7WUFDSSxJQUFHLElBQUMsQ0FBQSxHQUFHLENBQUMsT0FBTCxDQUFhLFFBQWIsQ0FBQSxJQUEwQixDQUE3QjtnQkFDSSxJQUFDLENBQUEsR0FBRyxDQUFDLE1BQUwsQ0FBWSxJQUFDLENBQUEsR0FBRyxDQUFDLE9BQUwsQ0FBYSxRQUFiLENBQVosRUFBb0MsQ0FBcEMsRUFESjs7WUFFQSxPQUFPLElBQUMsQ0FBQSxJQUFLLENBQUEsUUFBQTtZQUNiLE9BQU8sSUFBQyxDQUFBLElBQUssQ0FBQSxNQUFNLENBQUMsRUFBUDttQkFFYixLQUFLLENBQUMsR0FBTixDQUFVLFNBQUEsR0FBVSxJQUFDLENBQUEsR0FBckIsRUFBMkIsSUFBQyxDQUFBLEdBQTVCLEVBTko7O0lBTEk7O3dCQWFSLEdBQUEsR0FBSyxTQUFDLFFBQUQ7ZUFFRCxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQXZCLENBQThCLElBQUMsQ0FBQSxJQUFLLENBQUEsUUFBQSxDQUFwQztJQUZDOzs7Ozs7QUFJVCxNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwMFxuMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgIFxuMDAwMDAwMCAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgIFxuMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgIFxuMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgIFxuIyMjXG5cbnsgcG9zdCwgcHJlZnMsIGtsb2cgfSA9IHJlcXVpcmUgJ2t4aydcblxuZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcblxuY2xhc3MgS2FjaGVsU2V0XG5cbiAgICBAOiAobWFpbklkKSAtPlxuICAgICAgICBcbiAgICAgICAgQGZvY3VzS2FjaGVsID0gbnVsbFxuICAgICAgICBAZGljdCAgPSBcIiN7bWFpbklkfVwiOiAnbWFpbidcbiAgICAgICAgQHdpZHMgID0gbWFpbjptYWluSWRcbiAgICAgICAgQHNldCAgID0gW11cbiAgICAgICAgQHNpZCAgID0gJydcbiAgICAgICAgXG4gICAgICAgIHBvc3Qub24gJ2thY2hlbExvYWQnICBAb25LYWNoZWxMb2FkXG4gICAgICAgIHBvc3Qub24gJ3RvZ2dsZVNldCcgICBAb25Ub2dnbGVTZXRcbiAgICAgICAgcG9zdC5vbiAnbmV3U2V0JyAgICAgIEBvbk5ld1NldFxuICAgICAgICBwb3N0Lm9uICdrYWNoZWxGb2N1cycgQG9uS2FjaGVsRm9jdXNcbiAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgIFxuICAgIG9uS2FjaGVsRm9jdXM6ICh3aW5JZCkgPT5cbiAgICBcbiAgICAgICAgIyBrbG9nICdvbiBmb2N1cycgQGRpY3Rbd2luSWRdXG4gICAgICAgIGlmIEBkaWN0W3dpbklkXSAhPSAnbWFpbidcbiAgICAgICAgICAgIEBmb2N1c0thY2hlbCA9IGVsZWN0cm9uLkJyb3dzZXJXaW5kb3cuZnJvbUlkIHdpbklkXG5cbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgMCAwMDAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMCAgICAgMDAgIFxuICAgIFxuICAgIG9uTmV3U2V0OiA9PlxuICAgICAgICBcbiAgICAgICAgc2V0cyA9IHByZWZzLmdldCAnc2V0cycgWycnXVxuICAgICAgICBzZXRzLnB1c2ggXCIje3NldHMubGVuZ3RofVwiXG4gICAgICAgIHByZWZzLnNldCAnc2V0cycgc2V0c1xuICAgICAgICBAbG9hZCBzZXRzWy0xXVxuICAgICAgICBcbiAgICAjIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICMgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgIDAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAjICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgICAgMDAwICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgb25Ub2dnbGVTZXQ6ID0+XG4gICAgICAgIFxuICAgICAgICBzZXRzID0gcHJlZnMuZ2V0ICdzZXRzJyBbJyddXG4gICAgICAgIGluZGV4ID0gTWF0aC5tYXggMCwgc2V0cy5pbmRleE9mKEBzaWQpXG4gICAgICAgIFxuICAgICAgICBpZiBpbmRleCA+PSBzZXRzLmxlbmd0aC0xIHRoZW4gaW5kZXggPSAtMVxuICAgICAgICBAbG9hZCBzZXRzW2luZGV4KzFdXG4gICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBsb2FkOiAobmV3U2lkKSAtPlxuICAgICAgICAgICAgICAgIFxuICAgICAgICBuZXdTaWQgPz0gcHJlZnMuZ2V0ICdzZXQnICcnXG4gICAgICAgIFxuICAgICAgICBvbGRLYWNoZWxuID0gcHJlZnMuZ2V0IFwia2FjaGVsbiN7QHNpZH1cIiBbXVxuXG4gICAgICAgIEBrYWNoZWxJZHMgPSBbXVxuICAgICAgICB1cGRhdGVJZHMgPSBbJ21haW4nXVxuICAgICAgICBzaG93SWRzID0gW11cbiAgICAgICAgbmV3U2V0ID0gcHJlZnMuZ2V0IFwia2FjaGVsbiN7bmV3U2lkfVwiIFtdXG4gICAgICAgICMgb2xkTGVuID0gbmV3U2V0Lmxlbmd0aFxuICAgICAgICAjIG5ld1NldCA9IG5ld1NldC5maWx0ZXIgKGkpIC0+IGkgbm90IGluIFsnbWFpbicgJ2thY2hlbCcgJ2FwcGwnICdmb2xkZXInICdmaWxlJyAnbnVsbCcgJ3VuZGVmaW5lZCcgbnVsbCB1bmRlZmluZWRdXG4gICAgICAgICMga2xvZyAnbmV3U2V0JyBvbGRMZW4sIG5ld1NldC5sZW5ndGhcblxuICAgICAgICBmb3Iga2FjaGVsSWQgaW4gbmV3U2V0ID8gW11cbiAgICAgICAgICAgIGlmIGthY2hlbElkICE9ICdtYWluJ1xuICAgICAgICAgICAgICAgIGlmIEBzZXQuaW5kZXhPZihrYWNoZWxJZCkgPj0gMFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVJZHMucHVzaCBrYWNoZWxJZFxuICAgICAgICAgICAgICAgICAgICBAc2V0LnNwbGljZSBAc2V0LmluZGV4T2Yoa2FjaGVsSWQpLCAxXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBzaG93SWRzLnB1c2gga2FjaGVsSWRcbiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEB3aWRzW2thY2hlbElkXVxuICAgICAgICAgICAgICAgICAgICAgICAgQGthY2hlbElkcy5wdXNoIGthY2hlbElkXG5cbiAgICAgICAgaWYgQHNldC5sZW5ndGhcbiAgICAgICAgICAgIGZvciBrYWNoZWxJZCBpbiBAc2V0LnNsaWNlKClcbiAgICAgICAgICAgICAgICBpZiBrYWNoZWxJZCBub3QgaW4gWydtYWluJyAnbnVsbCcgbnVsbF1cbiAgICAgICAgICAgICAgICAgICAgaWYgQHdpZHNba2FjaGVsSWRdXG4gICAgICAgICAgICAgICAgICAgICAgICBAd2luKGthY2hlbElkKS5oaWRlKClcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAga2xvZyAnbm8gd2lkIGZvcicga2FjaGVsSWRcbiAgICAgICAgXG4gICAgICAgIHByZWZzLnNldCBcImthY2hlbG4je0BzaWR9XCIgb2xkS2FjaGVsblxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgQHNpZCA9IG5ld1NpZFxuICAgICAgICBwcmVmcy5zZXQgJ3NldCcgQHNpZFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgQHNldCA9IG5ld1NldFxuICAgICAgICBcbiAgICAgICAgZm9yIGthY2hlbElkIGluIHVwZGF0ZUlkc1xuICAgICAgICAgICAgcG9zdC5lbWl0ICd1cGRhdGVCb3VuZHMnIGthY2hlbElkXG5cbiAgICAgICAgZm9yIGthY2hlbElkIGluIHNob3dJZHNcbiAgICAgICAgICAgIHBvc3QuZW1pdCAnbmV3S2FjaGVsJyBrYWNoZWxJZFxuICAgICAgICAgICAgXG4gICAgICAgIGlmIEBrYWNoZWxJZHMubGVuZ3RoID09IDBcbiAgICAgICAgICAgIGtsb2cgJ2xvYWRlZCArKyBmb2N1cyBtYWluJ1xuICAgICAgICAgICAgQHdpbignbWFpbicpLmZvY3VzKClcbiAgICAgICAgICAgIHBvc3QuZW1pdCAnc2V0TG9hZGVkJ1xuICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwICAgMDAwICAgICAgICAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgMCAwMDAgICAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAwMDAwICAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIG9uS2FjaGVsTG9hZDogKHdpZCwga2FjaGVsSWQpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBrYWNoZWxJZCBub3QgaW4gQHNldFxuICAgICAgICAgICAgQHNldC5wdXNoIGthY2hlbElkIFxuICAgICAgICAgICAgcHJlZnMuc2V0IFwia2FjaGVsbiN7QHNpZH1cIiBAc2V0XG4gICAgICAgIFxuICAgICAgICBAZGljdFt3aWRdID0ga2FjaGVsSWRcbiAgICAgICAgQHdpZHNba2FjaGVsSWRdID0gd2lkXG4gICAgICAgIFxuICAgICAgICBpZiBAa2FjaGVsSWRzXG4gICAgICAgICAgICBpbmRleCA9IEBrYWNoZWxJZHMuaW5kZXhPZiBrYWNoZWxJZFxuICAgICAgICAgICAgaWYgaW5kZXggPj0gMFxuICAgICAgICAgICAgICAgIEBrYWNoZWxJZHMuc3BsaWNlIGluZGV4LCAxXG4gICAgICAgICAgICAgICAgaWYgQGthY2hlbElkcy5sZW5ndGggPT0gMFxuICAgICAgICAgICAgICAgICAgICBrbG9nICdzZXQgbG9hZGVkIC0tIGZvY3VzIG1haW4nXG4gICAgICAgICAgICAgICAgICAgIEB3aW4oJ21haW4nKS5mb2N1cygpXG4gICAgICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnc2V0TG9hZGVkJ1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGtsb2cgJ3Vua25vd24ga2FjaGVsPycga2FjaGVsSWRcblxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAgICAgIDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgICAwICAgICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIHJlbW92ZTogKGthY2hlbCkgLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBmb2N1c0thY2hlbCA9PSBrYWNoZWxcbiAgICAgICAgICAgIEBmb2N1c0thY2hlbCA9IG51bGxcbiAgICAgICAgXG4gICAgICAgIGlmIGthY2hlbElkID0gQGRpY3Rba2FjaGVsLmlkXVxuICAgICAgICAgICAgaWYgQHNldC5pbmRleE9mKGthY2hlbElkKSA+PSAwXG4gICAgICAgICAgICAgICAgQHNldC5zcGxpY2UgQHNldC5pbmRleE9mKGthY2hlbElkKSwgMVxuICAgICAgICAgICAgZGVsZXRlIEB3aWRzW2thY2hlbElkXVxuICAgICAgICAgICAgZGVsZXRlIEBkaWN0W2thY2hlbC5pZF1cbiAgICAgICAgICAgICMga2xvZyBcInByZWZzIHJlbW92ZSBmcm9tICN7QHNpZH1cIiBrYWNoZWxJZFxuICAgICAgICAgICAgcHJlZnMuc2V0IFwia2FjaGVsbiN7QHNpZH1cIiBAc2V0XG4gICAgICAgICAgICAgICAgXG4gICAgd2luOiAoa2FjaGVsSWQpIC0+XG4gICAgICAgICAgICBcbiAgICAgICAgZWxlY3Ryb24uQnJvd3NlcldpbmRvdy5mcm9tSWQgQHdpZHNba2FjaGVsSWRdXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBLYWNoZWxTZXRcbiJdfQ==
//# sourceURL=../coffee/kachelset.coffee