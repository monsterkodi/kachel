// koffee 1.4.0

/*
000   000   0000000    0000000  000   000  00000000  000       0000000  00000000  000000000
000  000   000   000  000       000   000  000       000      000       000          000   
0000000    000000000  000       000000000  0000000   000      0000000   0000000      000   
000  000   000   000  000       000   000  000       000           000  000          000   
000   000  000   000   0000000  000   000  00000000  0000000  0000000   00000000     000
 */
var Bounds, KachelSet, electron, empty, klog, post, prefs, ref, slash, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    indexOf = [].indexOf;

ref = require('kxk'), post = ref.post, slash = ref.slash, prefs = ref.prefs, empty = ref.empty, valid = ref.valid, klog = ref.klog;

Bounds = require('./bounds');

electron = require('electron');

KachelSet = (function() {
    function KachelSet(mainId) {
        this.onKachelLoad = bind(this.onKachelLoad, this);
        this.didLoad = bind(this.didLoad, this);
        this.onStoreSet = bind(this.onStoreSet, this);
        this.onRestoreSet = bind(this.onRestoreSet, this);
        this.onToggleSet = bind(this.onToggleSet, this);
        this.onNewSet = bind(this.onNewSet, this);
        this.onKachelFocus = bind(this.onKachelFocus, this);
        this.onKachelClose = bind(this.onKachelClose, this);
        this.onNewKachel = bind(this.onNewKachel, this);
        var obj;
        this.switching = false;
        this.focusKachel = null;
        this.hoverKachel = null;
        this.dict = (
            obj = {},
            obj["" + mainId] = 'main',
            obj
        );
        this.wids = {
            main: mainId
        };
        this.set = [];
        this.sid = '';
        post.on('kachelLoad', this.onKachelLoad);
        post.on('toggleSet', this.onToggleSet);
        post.on('restoreSet', this.onRestoreSet);
        post.on('storeSet', this.onStoreSet);
        post.on('newSet', this.onNewSet);
        post.on('kachelFocus', this.onKachelFocus);
        post.on('newKachel', this.onNewKachel);
    }

    KachelSet.prototype.onNewKachel = function(kachelId) {
        var kachelSize, type, win;
        if (kachelId === 'main') {
            return;
        }
        if (this.wids[kachelId]) {
            win = this.win(kachelId);
            win.showInactive();
            if (indexOf.call(this.set, kachelId) < 0) {
                this.set.push(kachelId);
                prefs.set("kacheln" + this.sid, this.set);
                klog('prefs save');
                prefs.save();
            }
            return;
        }
        kachelSize = 2;
        type = kachelId;
        if (kachelId.startsWith('start')) {
            type = 'start';
            kachelSize = 2;
        } else if (kachelId.endsWith('.app') || kachelId.endsWith('.exe')) {
            if (slash.base(kachelId) === 'konrad') {
                type = 'konrad';
                kachelSize = 4;
            } else {
                type = 'appl';
                kachelSize = 2;
            }
        } else if (kachelId.startsWith('/') || kachelId[1] === ':') {
            type = 'folder';
            kachelSize = 2;
        }
        switch (type) {
            case 'saver':
                kachelSize = 0;
                break;
            case 'sysdish':
            case 'sysinfo':
            case 'clock':
            case 'default':
                kachelSize = 2;
        }
        win = new electron.BrowserWindow({
            movable: true,
            transparent: true,
            autoHideMenuBar: true,
            acceptFirstMouse: true,
            hasShadow: false,
            frame: false,
            resizable: false,
            maximizable: false,
            minimizable: false,
            fullscreen: false,
            show: false,
            fullscreenenable: false,
            backgroundColor: '#181818',
            width: Bounds.kachelSizes[kachelSize],
            height: Bounds.kachelSizes[kachelSize],
            webPreferences: {
                nodeIntegration: true
            }
        });
        win.loadURL(KachelSet.html(type), {
            baseURLForDataURL: "file://" + __dirname + "/../js/index.html"
        });
        win.kachelId = kachelId;
        win.webContents.on('dom-ready', (function(id) {
            return function(event) {
                var wid;
                wid = event.sender.id;
                post.toWin(wid, 'initKachel', id);
                electron.BrowserWindow.fromId(wid).show();
                return Bounds.update();
            };
        })(kachelId));
        win.on('close', this.onKachelClose);
        win.setHasShadow(false);
        return win;
    };

    KachelSet.prototype.onKachelClose = function(event) {
        var kachel;
        kachel = event.sender;
        if (this.hoverKachel === kachel.id) {
            this.hoverKachel = null;
        }
        Bounds.remove(kachel);
        this.remove(kachel);
        return setTimeout((function() {
            return post.emit('bounds', 'dirty');
        }), 200);
    };

    KachelSet.prototype.onKachelFocus = function(winId) {
        if (this.dict[winId] !== 'main') {
            return this.focusKachel = electron.BrowserWindow.fromId(winId);
        }
    };

    KachelSet.prototype.onNewSet = function() {
        var sets;
        sets = prefs.get('sets', ['']);
        sets.push("" + sets.length);
        prefs.set('sets', sets);
        return this.load(sets.slice(-1)[0]);
    };

    KachelSet.prototype.onToggleSet = function() {
        var index, sets;
        if (this.switching) {
            return;
        }
        sets = prefs.get('sets', ['']);
        index = Math.max(0, sets.indexOf(this.sid));
        if (index >= sets.length - 1) {
            index = -1;
        }
        return this.load(sets[index + 1]);
    };

    KachelSet.prototype.onRestoreSet = function() {
        return this.load(this.sid, '_save');
    };

    KachelSet.prototype.onStoreSet = function() {
        prefs.set("kacheln" + this.sid + "_save", this.set);
        return prefs.save();
    };

    KachelSet.prototype.load = function(newSid, postfix) {
        var i, j, k, kachelId, l, len, len1, len2, len3, newSet, oldKacheln, ref1, ref2, showIds, updateIds;
        if (postfix == null) {
            postfix = '';
        }
        if (this.switching) {
            return;
        }
        this.switching = true;
        if (newSid != null) {
            newSid;
        } else {
            newSid = prefs.get('set', '');
        }
        if (empty(postfix)) {
            oldKacheln = prefs.get("kacheln" + this.sid, []);
        }
        this.kachelIds = [];
        updateIds = ['main'];
        showIds = [];
        newSet = prefs.get("kacheln" + newSid + postfix, []);
        ref1 = newSet != null ? newSet : [];
        for (i = 0, len = ref1.length; i < len; i++) {
            kachelId = ref1[i];
            if (kachelId !== 'main') {
                if (this.set.indexOf(kachelId) >= 0) {
                    updateIds.push(kachelId);
                    this.set.splice(this.set.indexOf(kachelId), 1);
                } else {
                    showIds.push(kachelId);
                    if (!this.wids[kachelId]) {
                        this.kachelIds.push(kachelId);
                    }
                }
            }
        }
        if (this.set.length) {
            ref2 = this.set.slice();
            for (j = 0, len1 = ref2.length; j < len1; j++) {
                kachelId = ref2[j];
                if (kachelId !== 'main' && kachelId !== 'null' && kachelId !== null) {
                    if (this.wids[kachelId]) {
                        this.win(kachelId).hide();
                    } else {
                        klog('no wid for', kachelId);
                    }
                }
            }
        }
        if (empty(postfix)) {
            prefs.set("kacheln" + this.sid, oldKacheln);
        }
        this.sid = newSid;
        prefs.set('set', this.sid);
        this.set = newSet;
        if (valid(postfix)) {
            prefs.set("kacheln" + newSid, this.set);
        }
        for (k = 0, len2 = updateIds.length; k < len2; k++) {
            kachelId = updateIds[k];
            post.emit('updateBounds', kachelId);
        }
        for (l = 0, len3 = showIds.length; l < len3; l++) {
            kachelId = showIds[l];
            this.onNewKachel(kachelId);
        }
        if (this.kachelIds.length === 0) {
            return this.didLoad();
        }
    };

    KachelSet.prototype.didLoad = function() {
        this.switching = false;
        this.win('main').focus();
        this.focusKachel = this.win('main');
        return post.emit('setLoaded');
    };

    KachelSet.prototype.onKachelLoad = function(wid, kachelId) {
        var index;
        if (indexOf.call(this.set, kachelId) < 0) {
            this.set.push(kachelId);
            prefs.set("kacheln" + this.sid, this.set);
            klog('prefs save');
            prefs.save();
        }
        this.dict[wid] = kachelId;
        this.wids[kachelId] = wid;
        if (this.kachelIds) {
            index = this.kachelIds.indexOf(kachelId);
            if (index >= 0) {
                this.kachelIds.splice(index, 1);
                if (this.kachelIds.length === 0) {
                    return this.didLoad();
                }
            } else {
                return klog('unknown kachel?', kachelId);
            }
        }
    };

    KachelSet.prototype.remove = function(kachel) {
        var kachelId;
        if (this.focusKachel === kachel) {
            this.focusKachel = null;
        }
        if (kachelId = this.dict[kachel.id]) {
            if (this.set.indexOf(kachelId) >= 0) {
                this.set.splice(this.set.indexOf(kachelId), 1);
            }
            delete this.wids[kachelId];
            delete this.dict[kachel.id];
            return prefs.set("kacheln" + this.sid, this.set);
        }
    };

    KachelSet.prototype.win = function(kachelId) {
        return electron.BrowserWindow.fromId(this.wids[kachelId]);
    };

    KachelSet.html = function(type) {
        var html;
        html = "<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"Content-Security-Policy\" content=\"default-src * 'unsafe-inline' 'unsafe-eval'\">\n    <link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\">\n    <link rel=\"stylesheet\" href=\"./css/dark.css\" type=\"text/css\" id=\"style-link\">\n  </head>\n  <body>\n    <div id=\"main\" tabindex=\"0\"></div>\n  </body>\n  <script>\n    Kachel = require(\"./" + type + ".js\");\n    new Kachel({});\n  </script>\n</html>";
        return "data:text/html;charset=utf-8," + encodeURI(html);
    };

    return KachelSet;

})();

module.exports = KachelSet;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2FjaGVsc2V0LmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSx3RUFBQTtJQUFBOzs7QUFRQSxNQUE2QyxPQUFBLENBQVEsS0FBUixDQUE3QyxFQUFFLGVBQUYsRUFBUSxpQkFBUixFQUFlLGlCQUFmLEVBQXNCLGlCQUF0QixFQUE2QixpQkFBN0IsRUFBb0M7O0FBRXBDLE1BQUEsR0FBVyxPQUFBLENBQVEsVUFBUjs7QUFDWCxRQUFBLEdBQVcsT0FBQSxDQUFRLFVBQVI7O0FBRUw7SUFFQyxtQkFBQyxNQUFEOzs7Ozs7Ozs7O0FBRUMsWUFBQTtRQUFBLElBQUMsQ0FBQSxTQUFELEdBQWU7UUFFZixJQUFDLENBQUEsV0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLFdBQUQsR0FBZTtRQUVmLElBQUMsQ0FBQSxJQUFELEdBQVM7a0JBQUEsRUFBQTtnQkFBQSxFQUFBLEdBQUcsVUFBVSxNQUFiOzs7UUFDVCxJQUFDLENBQUEsSUFBRCxHQUFTO1lBQUEsSUFBQSxFQUFLLE1BQUw7O1FBQ1QsSUFBQyxDQUFBLEdBQUQsR0FBUztRQUNULElBQUMsQ0FBQSxHQUFELEdBQVM7UUFFVCxJQUFJLENBQUMsRUFBTCxDQUFRLFlBQVIsRUFBc0IsSUFBQyxDQUFBLFlBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxXQUFSLEVBQXNCLElBQUMsQ0FBQSxXQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsWUFBUixFQUFzQixJQUFDLENBQUEsWUFBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFVBQVIsRUFBc0IsSUFBQyxDQUFBLFVBQXZCO1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxRQUFSLEVBQXNCLElBQUMsQ0FBQSxRQUF2QjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsYUFBUixFQUFzQixJQUFDLENBQUEsYUFBdkI7UUFDQSxJQUFJLENBQUMsRUFBTCxDQUFRLFdB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LE1BQXZCLENBQThCLElBQUMsQ0FBQSxJQUFLLENBQUEsUUFBQSxDQUFwQztJQUZDOztJQVVMLFNBQUMsQ0FBQSxJQUFELEdBQU8sU0FBQyxJQUFEO0FBRUgsWUFBQTtRQUFBLElBQUEsR0FBTyxnZEFBQSxHQWF1QixJQWJ2QixHQWE0QjtlQU1uQywrQkFBQSxHQUFrQyxTQUFBLENBQVUsSUFBVjtJQXJCL0I7Ozs7OztBQXVCWCxNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwMFxuMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgIFxuMDAwMDAwMCAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgIFxuMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgIFxuMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgIFxuIyMjXG5cbnsgcG9zdCwgc2xhc2gsIHByZWZzLCBlbXB0eSwgdmFsaWQsIGtsb2cgfSA9IHJlcXVpcmUgJ2t4aydcblxuQm91bmRzICAgPSByZXF1aXJlICcuL2JvdW5kcydcbmVsZWN0cm9uID0gcmVxdWlyZSAnZWxlY3Ryb24nXG5cbmNsYXNzIEthY2hlbFNldFxuXG4gICAgQDogKG1haW5JZCkgLT5cbiAgICAgICAgXG4gICAgICAgIEBzd2l0Y2hpbmcgICA9IGZhbHNlXG4gICAgICAgIFxuICAgICAgICBAZm9jdXNLYWNoZWwgPSBudWxsXG4gICAgICAgIEBob3ZlckthY2hlbCA9IG51bGxcbiAgICAgICAgXG4gICAgICAgIEBkaWN0ICA9IFwiI3ttYWluSWR9XCI6ICdtYWluJ1xuICAgICAgICBAd2lkcyAgPSBtYWluOm1haW5JZFxuICAgICAgICBAc2V0ICAgPSBbXVxuICAgICAgICBAc2lkICAgPSAnJ1xuICAgICAgICBcbiAgICAgICAgcG9zdC5vbiAna2FjaGVsTG9hZCcgIEBvbkthY2hlbExvYWRcbiAgICAgICAgcG9zdC5vbiAndG9nZ2xlU2V0JyAgIEBvblRvZ2dsZVNldFxuICAgICAgICBwb3N0Lm9uICdyZXN0b3JlU2V0JyAgQG9uUmVzdG9yZVNldFxuICAgICAgICBwb3N0Lm9uICdzdG9yZVNldCcgICAgQG9uU3RvcmVTZXRcbiAgICAgICAgcG9zdC5vbiAnbmV3U2V0JyAgICAgIEBvbk5ld1NldFxuICAgICAgICBwb3N0Lm9uICdrYWNoZWxGb2N1cycgQG9uS2FjaGVsRm9jdXNcbiAgICAgICAgcG9zdC5vbiAnbmV3S2FjaGVsJyAgIEBvbk5ld0thY2hlbFxuICAgICAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgXG4gICAgIyAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgMCAwMDAgICAgICAgIDAwMCAgMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAgICAgXG4gICAgIyAwMDAgIDAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgICAgIDAwMCAgMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMCAgICAgMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgXG5cbiAgICBvbk5ld0thY2hlbDogKGthY2hlbElkKSA9PlxuXG4gICAgICAgIHJldHVybiBpZiBrYWNoZWxJZCA9PSAnbWFpbidcbiAgICAgICAgXG4gICAgICAgIGlmIEB3aWRzW2thY2hlbElkXVxuICAgICAgICAgICAgd2luID0gQHdpbiBrYWNoZWxJZFxuICAgICAgICAgICAgd2luLnNob3dJbmFjdGl2ZSgpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIGthY2hlbElkIG5vdCBpbiBAc2V0XG4gICAgICAgICAgICAgICAgQHNldC5wdXNoIGthY2hlbElkIFxuICAgICAgICAgICAgICAgIHByZWZzLnNldCBcImthY2hlbG4je0BzaWR9XCIgQHNldFxuICAgICAgICAgICAgICAgIGtsb2cgJ3ByZWZzIHNhdmUnXG4gICAgICAgICAgICAgICAgcHJlZnMuc2F2ZSgpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICBcbiAgICAgICAga2FjaGVsU2l6ZSA9IDJcbiAgICBcbiAgICAgICAgdHlwZSA9IGthY2hlbElkXG4gICAgICAgIGlmIGthY2hlbElkLnN0YXJ0c1dpdGggJ3N0YXJ0J1xuICAgICAgICAgICAgdHlwZSA9ICdzdGFydCdcbiAgICAgICAgICAgIGthY2hlbFNpemUgPSAyXG4gICAgICAgIGVsc2UgaWYga2FjaGVsSWQuZW5kc1dpdGgoJy5hcHAnKSBvciBrYWNoZWxJZC5lbmRzV2l0aCgnLmV4ZScpXG4gICAgICAgICAgICBpZiBzbGFzaC5iYXNlKGthY2hlbElkKSA9PSAna29ucmFkJ1xuICAgICAgICAgICAgICAgIHR5cGUgPSAna29ucmFkJ1xuICAgICAgICAgICAgICAgIGthY2hlbFNpemUgPSA0XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdHlwZSA9ICdhcHBsJ1xuICAgICAgICAgICAgICAgIGthY2hlbFNpemUgPSAyXG4gICAgICAgIGVsc2UgaWYga2FjaGVsSWQuc3RhcnRzV2l0aCgnLycpIG9yIGthY2hlbElkWzFdID09ICc6J1xuICAgICAgICAgICAgdHlwZSA9ICdmb2xkZXInXG4gICAgICAgICAgICBrYWNoZWxTaXplID0gMlxuICAgICAgICAgICAgXG4gICAgICAgIHN3aXRjaCB0eXBlXG4gICAgICAgICAgICB3aGVuICdzYXZlcicgdGhlbiBrYWNoZWxTaXplID0gMFxuICAgICAgICAgICAgd2hlbiAnc3lzZGlzaCcgJ3N5c2luZm8nICdjbG9jaycgJ2RlZmF1bHQnIHRoZW4ga2FjaGVsU2l6ZSA9IDJcbiAgICAgICAgICAgIFxuICAgICAgICB3aW4gPSBuZXcgZWxlY3Ryb24uQnJvd3NlcldpbmRvd1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBtb3ZhYmxlOiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgIHRyYW5zcGFyZW50OiAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgYXV0b0hpZGVNZW51QmFyOiAgICB0cnVlXG4gICAgICAgICAgICBhY2NlcHRGaXJzdE1vdXNlOiAgIHRydWVcbiAgICAgICAgICAgIGhhc1NoYWRvdzogICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIGZyYW1lOiAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIHJlc2l6YWJsZTogICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIG1heGltaXphYmxlOiAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIG1pbmltaXphYmxlOiAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIGZ1bGxzY3JlZW46ICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIHNob3c6ICAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIGZ1bGxzY3JlZW5lbmFibGU6ICAgZmFsc2VcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogICAgJyMxODE4MTgnXG4gICAgICAgICAgICB3aWR0aDogICAgICAgICAgICAgIEJvdW5kcy5rYWNoZWxTaXplc1trYWNoZWxTaXplXVxuICAgICAgICAgICAgaGVpZ2h0OiAgICAgICAgICAgICBCb3VuZHMua2FjaGVsU2l6ZXNba2FjaGVsU2l6ZV1cbiAgICAgICAgICAgIHdlYlByZWZlcmVuY2VzOiBcbiAgICAgICAgICAgICAgICBub2RlSW50ZWdyYXRpb246IHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICB3aW4ubG9hZFVSTCBLYWNoZWxTZXQuaHRtbCh0eXBlKSwgYmFzZVVSTEZvckRhdGFVUkw6XCJmaWxlOi8vI3tfX2Rpcm5hbWV9Ly4uL2pzL2luZGV4Lmh0bWxcIlxuICAgICAgICBcbiAgICAgICAgd2luLmthY2hlbElkID0ga2FjaGVsSWRcbiAgICAgICAgXG4gICAgICAgIHdpbi53ZWJDb250ZW50cy5vbiAnZG9tLXJlYWR5JyAoKGlkKSAtPiAoZXZlbnQpIC0+XG4gICAgICAgICAgICB3aWQgPSBldmVudC5zZW5kZXIuaWRcbiAgICAgICAgICAgIHBvc3QudG9XaW4gd2lkLCAnaW5pdEthY2hlbCcgaWRcbiAgICAgICAgICAgIGVsZWN0cm9uLkJyb3dzZXJXaW5kb3cuZnJvbUlkKHdpZCkuc2hvdygpXG4gICAgICAgICAgICBCb3VuZHMudXBkYXRlKClcbiAgICAgICAgICAgICkoa2FjaGVsSWQpXG4gICAgICAgICAgICAgIFxuICAgICAgICB3aW4ub24gJ2Nsb3NlJyBAb25LYWNoZWxDbG9zZVxuICAgICAgICB3aW4uc2V0SGFzU2hhZG93IGZhbHNlICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICB3aW5cbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBvbkthY2hlbENsb3NlOiAoZXZlbnQpID0+XG4gICAgICAgICAgICBcbiAgICAgICAga2FjaGVsID0gZXZlbnQuc2VuZGVyXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIGlmIEBob3ZlckthY2hlbCA9PSBrYWNoZWwuaWRcbiAgICAgICAgICAgIEBob3ZlckthY2hlbCA9IG51bGxcbiAgICAgICAgICAgIFxuICAgICAgICBCb3VuZHMucmVtb3ZlIGthY2hlbFxuICAgICAgICBAcmVtb3ZlIGthY2hlbCAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgc2V0VGltZW91dCAoLT4gcG9zdC5lbWl0ICdib3VuZHMnICdkaXJ0eScpLCAyMDBcbiAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgXG4gICAgXG4gICAgb25LYWNoZWxGb2N1czogKHdpbklkKSA9PlxuICAgIFxuICAgICAgICAjIGtsb2cgJ29uIGZvY3VzJyBAZGljdFt3aW5JZF1cbiAgICAgICAgaWYgQGRpY3Rbd2luSWRdICE9ICdtYWluJ1xuICAgICAgICAgICAgQGZvY3VzS2FjaGVsID0gZWxlY3Ryb24uQnJvd3NlcldpbmRvdy5mcm9tSWQgd2luSWRcblxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAwIDAwMCAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwICAgICAwMCAgXG4gICAgXG4gICAgb25OZXdTZXQ6ID0+XG4gICAgICAgIFxuICAgICAgICBzZXRzID0gcHJlZnMuZ2V0ICdzZXRzJyBbJyddXG4gICAgICAgIHNldHMucHVzaCBcIiN7c2V0cy5sZW5ndGh9XCJcbiAgICAgICAgcHJlZnMuc2V0ICdzZXRzJyBzZXRzXG4gICAgICAgIEBsb2FkIHNldHNbLTFdXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAwMDAwMCAgXG4gICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAjICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgMDAwMDAwMCAgIFxuICAgICMgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgIyAgICAwMDAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBvblRvZ2dsZVNldDogPT5cblxuICAgICAgICByZXR1cm4gaWYgQHN3aXRjaGluZ1xuICAgICAgICBcbiAgICAgICAgc2V0cyA9IHByZWZzLmdldCAnc2V0cycgWycnXVxuICAgICAgICBpbmRleCA9IE1hdGgubWF4IDAsIHNldHMuaW5kZXhPZihAc2lkKVxuICAgICAgICBcbiAgICAgICAgaWYgaW5kZXggPj0gc2V0cy5sZW5ndGgtMSB0aGVuIGluZGV4ID0gLTFcbiAgICAgICAgQGxvYWQgc2V0c1tpbmRleCsxXVxuICAgICAgICBcbiAgICBvblJlc3RvcmVTZXQ6ID0+XG5cbiAgICAgICAgQGxvYWQgQHNpZCwgJ19zYXZlJ1xuXG4gICAgb25TdG9yZVNldDogPT5cblxuICAgICAgICBwcmVmcy5zZXQgXCJrYWNoZWxuI3tAc2lkfV9zYXZlXCIgQHNldCBcbiAgICAgICAgcHJlZnMuc2F2ZSgpXG4gICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBsb2FkOiAobmV3U2lkLCBwb3N0Zml4PScnKSAtPlxuICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIEBzd2l0Y2hpbmdcbiAgICAgICAgICAgIFxuICAgICAgICBAc3dpdGNoaW5nID0gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgbmV3U2lkID89IHByZWZzLmdldCAnc2V0JyAnJ1xuICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgcG9zdGZpeFxuICAgICAgICAgICAgb2xkS2FjaGVsbiA9IHByZWZzLmdldCBcImthY2hlbG4je0BzaWR9XCIgW11cblxuICAgICAgICBAa2FjaGVsSWRzID0gW11cbiAgICAgICAgdXBkYXRlSWRzID0gWydtYWluJ11cbiAgICAgICAgc2hvd0lkcyA9IFtdXG4gICAgICAgIG5ld1NldCA9IHByZWZzLmdldCBcImthY2hlbG4je25ld1NpZH0je3Bvc3RmaXh9XCIgW11cblxuICAgICAgICBmb3Iga2FjaGVsSWQgaW4gbmV3U2V0ID8gW11cbiAgICAgICAgICAgIGlmIGthY2hlbElkICE9ICdtYWluJ1xuICAgICAgICAgICAgICAgIGlmIEBzZXQuaW5kZXhPZihrYWNoZWxJZCkgPj0gMFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVJZHMucHVzaCBrYWNoZWxJZFxuICAgICAgICAgICAgICAgICAgICBAc2V0LnNwbGljZSBAc2V0LmluZGV4T2Yoa2FjaGVsSWQpLCAxXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBzaG93SWRzLnB1c2gga2FjaGVsSWRcbiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEB3aWRzW2thY2hlbElkXVxuICAgICAgICAgICAgICAgICAgICAgICAgQGthY2hlbElkcy5wdXNoIGthY2hlbElkXG5cbiAgICAgICAgaWYgQHNldC5sZW5ndGhcbiAgICAgICAgICAgIGZvciBrYWNoZWxJZCBpbiBAc2V0LnNsaWNlKClcbiAgICAgICAgICAgICAgICBpZiBrYWNoZWxJZCBub3QgaW4gWydtYWluJyAnbnVsbCcgbnVsbF1cbiAgICAgICAgICAgICAgICAgICAgaWYgQHdpZHNba2FjaGVsSWRdXG4gICAgICAgICAgICAgICAgICAgICAgICBAd2luKGthY2hlbElkKS5oaWRlKClcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAga2xvZyAnbm8gd2lkIGZvcicga2FjaGVsSWRcbiAgICAgICAgXG4gICAgICAgIGlmIGVtcHR5IHBvc3RmaXhcbiAgICAgICAgICAgIHByZWZzLnNldCBcImthY2hlbG4je0BzaWR9XCIgb2xkS2FjaGVsblxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgQHNpZCA9IG5ld1NpZFxuICAgICAgICBwcmVmcy5zZXQgJ3NldCcgQHNpZFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgQHNldCA9IG5ld1NldFxuICAgICAgICBcbiAgICAgICAgaWYgdmFsaWQgcG9zdGZpeFxuICAgICAgICAgICAgcHJlZnMuc2V0IFwia2FjaGVsbiN7bmV3U2lkfVwiIEBzZXRcbiAgICAgICAgXG4gICAgICAgIGZvciBrYWNoZWxJZCBpbiB1cGRhdGVJZHNcbiAgICAgICAgICAgIHBvc3QuZW1pdCAndXBkYXRlQm91bmRzJyBrYWNoZWxJZFxuXG4gICAgICAgIGZvciBrYWNoZWxJZCBpbiBzaG93SWRzXG4gICAgICAgICAgICBAb25OZXdLYWNoZWwga2FjaGVsSWRcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBAa2FjaGVsSWRzLmxlbmd0aCA9PSAwXG4gICAgICAgICAgICBAZGlkTG9hZCgpXG4gICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwICAwMDAwMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAgIDAwMDAwMDAgICAgICAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgZGlkTG9hZDogPT5cbiAgICAgICAgXG4gICAgICAgIEBzd2l0Y2hpbmcgPSBmYWxzZVxuICAgICAgICBAd2luKCdtYWluJykuZm9jdXMoKVxuICAgICAgICBAZm9jdXNLYWNoZWwgPSBAd2luKCdtYWluJylcbiAgICAgICAgcG9zdC5lbWl0ICdzZXRMb2FkZWQnXG4gICAgICAgICAgIFxuICAgICMgMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIG9uS2FjaGVsTG9hZDogKHdpZCwga2FjaGVsSWQpID0+XG4gICAgICAgICAgICBcbiAgICAgICAgIyBrbG9nICdvbkxvYWQnIEBzaWQsIEBzZXQubGVuZ3RoLCBrYWNoZWxJZFxuICAgICAgICBcbiAgICAgICAgaWYga2FjaGVsSWQgbm90IGluIEBzZXRcbiAgICAgICAgICAgIEBzZXQucHVzaCBrYWNoZWxJZCBcbiAgICAgICAgICAgIHByZWZzLnNldCBcImthY2hlbG4je0BzaWR9XCIgQHNldFxuICAgICAgICAgICAga2xvZyAncHJlZnMgc2F2ZSdcbiAgICAgICAgICAgIHByZWZzLnNhdmUoKVxuICAgICAgICBcbiAgICAgICAgQGRpY3Rbd2lkXSA9IGthY2hlbElkXG4gICAgICAgIEB3aWRzW2thY2hlbElkXSA9IHdpZFxuICAgICAgICBcbiAgICAgICAgaWYgQGthY2hlbElkc1xuICAgICAgICAgICAgaW5kZXggPSBAa2FjaGVsSWRzLmluZGV4T2Yga2FjaGVsSWRcbiAgICAgICAgICAgIGlmIGluZGV4ID49IDBcbiAgICAgICAgICAgICAgICBAa2FjaGVsSWRzLnNwbGljZSBpbmRleCwgMVxuICAgICAgICAgICAgICAgIGlmIEBrYWNoZWxJZHMubGVuZ3RoID09IDAgdGhlbiBAZGlkTG9hZCgpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAga2xvZyAndW5rbm93biBrYWNoZWw/JyBrYWNoZWxJZFxuXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgIDAgICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgcmVtb3ZlOiAoa2FjaGVsKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQGZvY3VzS2FjaGVsID09IGthY2hlbFxuICAgICAgICAgICAgQGZvY3VzS2FjaGVsID0gbnVsbFxuICAgICAgICBcbiAgICAgICAgaWYga2FjaGVsSWQgPSBAZGljdFtrYWNoZWwuaWRdXG4gICAgICAgICAgICBpZiBAc2V0LmluZGV4T2Yoa2FjaGVsSWQpID49IDBcbiAgICAgICAgICAgICAgICBAc2V0LnNwbGljZSBAc2V0LmluZGV4T2Yoa2FjaGVsSWQpLCAxXG4gICAgICAgICAgICBkZWxldGUgQHdpZHNba2FjaGVsSWRdXG4gICAgICAgICAgICBkZWxldGUgQGRpY3Rba2FjaGVsLmlkXVxuICAgICAgICAgICAgIyBrbG9nIFwicHJlZnMgcmVtb3ZlIGZyb20gI3tAc2lkfVwiIGthY2hlbElkXG4gICAgICAgICAgICBwcmVmcy5zZXQgXCJrYWNoZWxuI3tAc2lkfVwiIEBzZXRcbiAgICAgICAgICAgICAgICBcbiAgICB3aW46IChrYWNoZWxJZCkgLT5cbiAgICAgICAgICAgIFxuICAgICAgICBlbGVjdHJvbi5Ccm93c2VyV2luZG93LmZyb21JZCBAd2lkc1trYWNoZWxJZF1cbiAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAgICAgIDAwICAwMDAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgIFxuICAgICMgMDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAwMCAgMDAwICAgICAgXG4gICAgIyAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwIDAgMDAwICAwMDAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuICAgIFxuICAgIEBodG1sOiAodHlwZSkgLT5cbiAgICAgICAgXG4gICAgICAgIGh0bWwgPSBcIlwiXCJcbiAgICAgICAgICAgIDwhRE9DVFlQRSBodG1sPlxuICAgICAgICAgICAgPGh0bWwgbGFuZz1cImVuXCI+XG4gICAgICAgICAgICAgIDxoZWFkPlxuICAgICAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9XCJ1dGYtOFwiPlxuICAgICAgICAgICAgICAgIDxtZXRhIGh0dHAtZXF1aXY9XCJDb250ZW50LVNlY3VyaXR5LVBvbGljeVwiIGNvbnRlbnQ9XCJkZWZhdWx0LXNyYyAqICd1bnNhZmUtaW5saW5lJyAndW5zYWZlLWV2YWwnXCI+XG4gICAgICAgICAgICAgICAgPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIGhyZWY9XCIuL2Nzcy9zdHlsZS5jc3NcIiB0eXBlPVwidGV4dC9jc3NcIj5cbiAgICAgICAgICAgICAgICA8bGluayByZWw9XCJzdHlsZXNoZWV0XCIgaHJlZj1cIi4vY3NzL2RhcmsuY3NzXCIgdHlwZT1cInRleHQvY3NzXCIgaWQ9XCJzdHlsZS1saW5rXCI+XG4gICAgICAgICAgICAgIDwvaGVhZD5cbiAgICAgICAgICAgICAgPGJvZHk+XG4gICAgICAgICAgICAgICAgPGRpdiBpZD1cIm1haW5cIiB0YWJpbmRleD1cIjBcIj48L2Rpdj5cbiAgICAgICAgICAgICAgPC9ib2R5PlxuICAgICAgICAgICAgICA8c2NyaXB0PlxuICAgICAgICAgICAgICAgIEthY2hlbCA9IHJlcXVpcmUoXCIuLyN7dHlwZX0uanNcIik7XG4gICAgICAgICAgICAgICAgbmV3IEthY2hlbCh7fSk7XG4gICAgICAgICAgICAgIDwvc2NyaXB0PlxuICAgICAgICAgICAgPC9odG1sPlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgXG4gICAgICAgIFwiZGF0YTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCxcIiArIGVuY29kZVVSSSBodG1sXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBLYWNoZWxTZXRcbiJdfQ==
//# sourceURL=../coffee/kachelset.coffee